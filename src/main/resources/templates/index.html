<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Homepage</title>


    <style>
        /* Set the size of the div element that contains the map */
        #map {
            height: 700px; /* The height is 400 pixels */
            width: 100%; /* The width is the width of the web page */
        }
    </style>

    <script
            src="http://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>
</head>
<body>


<h1>ISS tracker</h1>


<div id="map"></div>


<script>

    function initMap() {

        var intervalInMilliseconds = 1000;
        var markers = [];
        // var icon = 'https://i.ibb.co/72gpnJ4/956251-200.png';


        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 8,
            center: {lat: 0, lng: 0},
            mapTypeId: 'hybrid'
        });


        setInterval(mycode, intervalInMilliseconds);

        function mycode() {
            getJSON('http://localhost:8080/position',
                function (err, data) {
                    if (err !== null) {
                        console.log('Something went wrong: ' + err);
                    } else {

                        setMapOnAll(null);

                        map.setCenter({lat: data.latitude, lng: data.longitude});
                        map.setZoom({zoom: 9});
                        var marker = new google.maps.Marker({
                            position: {lat: data.latitude, lng: data.longitude},
                            map: map,
                            // icon: icon
                        });
                        markers.push(marker);
                    }
                });
        }

        function setMapOnAll(map) {
            for (var i = 0; i < markers.length; i++) {
                markers[i].setMap(map);
            }
        }

        var getJSON = function (url, callback) {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', url, true);
            xhr.responseType = 'json';
            xhr.onload = function () {
                var status = xhr.status;
                if (status === 200) {
                    callback(null, xhr.response);
                } else {
                    callback(status, xhr.response);
                }
            };
            xhr.send();
        };
    }
</script>

<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAKMSf74WjPCIZBva_RDKFJgs0RHzmUkj8&callback=initMap">
</script>

</body>
</html>